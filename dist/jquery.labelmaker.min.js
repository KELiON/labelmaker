!function(e){e.fn.labelmaker=function(t,o){function n(t){var o=[];return t.children().each(function(){var t={};t.top=e(this).data("top"),t.left=e(this).data("left"),t.text=e(this).text(),o.push(t)}),o}function l(e,t){t.forEach(function(t){e.append('<div class="labelmaker-point" style="top:'+t.top+"%; left:"+t.left+'%;"></div>').append('<div class="labelmaker-bubble"><div class="labelmaker-bubble-inner">'+t.text+"</div></div>")})}function i(e){e.find(".labelmaker-point, .labelmaker-bubble").remove()}function a(e){e.find(".labelmaker-bubble").removeClass("active").removeAttr("style")}function r(t){t.on("DOMMouseScroll mousewheel",function(t){var o=e(this),n=this.scrollTop,l=this.scrollHeight,i=o.outerHeight(),a="DOMMouseScroll"==t.type?-40*t.originalEvent.detail:t.originalEvent.wheelDelta,r=a>0,c=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1};return!r&&-a>l-i-n?(o.scrollTop(l),c()):r&&a>n?(o.scrollTop(0),c()):void 0})}function c(t,o,n,l){var i,a=t.outerWidth(),c=t.position(),s=o.outerHeight(),u=o.outerWidth(),b=l-c.top-a,h=n-c.left-a,p=c.top+a,f=c.left+a;s>b&&(i=-1*(l-p-s),p=p-i-a/2),u>h&&(i=-1*(n-f-u),f=f-i-a/2),o.css({top:p,left:f}).addClass("active"),s<o.find(".labelmaker-bubble-inner").prop("scrollHeight")&&(o.addClass("scrollable"),r(e(".scrollable .labelmaker-bubble-inner")))}function s(o){function r(){h.removeAttr("style"),s=o.width(),b=o.height(),h.width(s).height(b),i(h),l(h,p)}var s=o.width(),b=o.height();o.wrap('<div class="labelmaker-container" />');var h=o.parent(".labelmaker-container");h.width(s).height(b),t.hide();var p=n(t);l(h,p),"hover"===u.showBubbleOn?h.on({mouseenter:function(t){t.stopPropagation(),t.preventDefault(),a(h),$bubble=e(this).next(),$point=e(this),c($point,$bubble,s,b)},mouseleave:function(){a(h)}},".labelmaker-point"):(h.on("click touchstart",".labelmaker-point",function(t){console.log("click",e(this)),t.stopPropagation(),t.preventDefault(),a(h),$bubble=e(this).next(),$point=e(this),c($point,$bubble,s,b)}),h.on("click touchstart",".labelmaker-bubble",function(e){e.stopPropagation()}),h.on("click touchstart",function(){console.log("hide all"),a(h)}));var f;e(window).on("resize orientationChanged",function(){clearTimeout(f),f=setTimeout(r,100)})}var u=e.extend({showBubbleOn:"click"},o);return this.each(function(){var t=e(this);t.one("load",function(){s(t)}).each(function(){this.complete&&e(this).load()})})}}(jQuery);